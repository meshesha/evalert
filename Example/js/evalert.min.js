/*
@eValert - events alert - jQuery plugin 
@author: Tadele Meshesha
@creationDate: 01/01/2017
@version: 1.0.0
@authorEmail: meshesha1@gmail.com
@license: GPL3
*/ 
!function(e){e.fn.evalert=function(t){function r(e){var t=e.name,r=e.startdate,o=e.starttime;(""==o||void 0==o)&&(o="0:0");var n=e.url,l=e.bgcolor,i=e.color,s=e.eventalert;a(t,r,o,s,n,l,i)}function a(e,t,r,a,n,l,i){var s="Name: "+e+".Date: "+t+".Time: "+r;""!=n&&(s+='<a href="'+n+'" target="_blank"> Link. </a>');var v,d,u=a.split(";"),p=u[0].split("=")[1],m=u[1].split("=")[1],b=Number(u[2].split("=")[1]);if(c.eventOntimeAlert){var h=s;h+="",v=[e,t,r,0,h,l,i],o(v)}if("ALERT"==p)switch(m){case"WEEK":var h=s;h+=".The event will occur in "+b+" weeks.",d=604800*b,v=[e,t,r,d,h,l,i],o(v);break;case"DAY":var h=s;h+=".The event will occur in "+b+" days.",d=86400*b,v=[e,t,r,d,h,l,i],o(v);break;case"HOUR":var h=s;h+=".The event will occur in "+b+" hours.",d=3600*b,v=[e,t,r,d,h,l,i],o(v);break;case"MIN":var h=s;h+=".The event will occur in "+b+" minutes.",d=60*b,v=[e,t,r,d,h,l,i],o(v)}}function o(e){var t,r=(e[0],e[1]),a=e[2],o=e[3],l=e[4],i=e[5],c=e[6],v=r.split("-"),d=Number(v[0]),u=Number(v[1])-1,p=Number(v[2]),m=a.split(":"),b=Number(m[0]),h=Number(m[1]),f=new Date(d,u,p,b,h,0,0),g=f.getTime(),x=Math.round(g/1e3)-o,C=new Date,k=C.getTime(),y=Math.round(k/1e3),w=s.length;t=0==w?1:s[w-1].timerIndex+1,s[t]={remaining:y,stop:x,timerId:setInterval(function(){n(t)},1e3),timerMsg:l,timerIndex:t,bColor:i,tColor:c}}function n(e){var t=s[e].remaining,r=s[e].stop;if(t==r){clearInterval(s[e].timerId);var a=s[e].timerMsg,o=s[e].bColor,n=s[e].tColor;i(a,o,n)}else t>r?clearInterval(s[e].timerId):t++;s[e].remaining=t}function l(e){var t;return t=window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue("direction"):e.currentStyle.direction}function i(t,r,a){var o="",n="";""!=r&&(o="background:"+r+";"),""!=a&&(n="color:"+a+";");var l=e("#"+d+" .evalert-toolbar-title-evnt-counter").html(),i=Number(l)+1;e("#"+d+" .evalert-toolbar-title-evnt-counter").html(i),c.newAlertFirst?e("#"+d+" .evalert-content").prepend('<div class="evalert-alert" style="'+o+n+'"><span class="evalert-close-button" id="evalert-close-button-'+i+'">&times;</span><span>'+t+"</span></div>"):e("#"+d+" .evalert-content").append('<div class="evalert-alert" style="'+o+n+'"><span class="evalert-close-button" id="evalert-close-button-'+i+'">&times;</span><span>'+t+"</span></div>"),e("#"+d+" .evalert-close-button").on("click",function(){e(this).parent().remove();var t=e("#"+d+" .evalert-alert").length;e("#"+d+" .evalert-toolbar-title-evnt-counter").html(t)})}var s=[],c=e.extend({eventSource:"",eventUrl:"",eventParams:"",eventOntimeAlert:!0,alertWinPos:!1,alertWinWidth:!1,alertWinHeight:!1,title:"Events Box",newAlertFirst:!0,bodyBorderColor:!1,titleBgColor:!1,titleTextColor:"white",titleFontSize:"15px",contentBgColor:"white",contentFontSize:"10px"},t);if(""!=c.eventParams&&"object"==typeof c.eventParams&&e.each(c.eventParams,function(e,t){var r=[];r.push(e);var o=r.concat(t),n=o[0],l=o[1],i=o[2];(""==i||void 0==i)&&(i="0:0");var s=o[3],c=o[4],v=o[5],d=o[6];a(n,l,i,s,c,v,d)}),""!=c.eventSource){var v=c.eventUrl;""==v&&console.error("you need to provide eventUrl"),"json"==c.eventSource?e.get(""+v,{now:e.now()},function(t){e.each(t.jcal,function(e,t){r(t)})},c.eventSource).fail(function(){console.error("evalert.js failed to import "+v+". Please check for the correct path & "+c.eventSource+" syntax.")}):"php"==c.eventSource&&e.ajax({type:"POST",url:v,data:{data:"evalert_ajax"},success:function(t){var a=e.parseJSON(t);e.each(a.jcal,function(e,t){r(t)})}})}var d,u=e(this).prop("tagName");"BODY"==u||"body"==u?(e(document.body).append('<div id="timer_alert_msg"></div>'),d="timer_alert_msg"):void 0!=e(this).attr("id")?d=e(this).attr("id"):(d="timer_alert_msg",e(this).attr("id",d)),e("#"+d).hasClass("evalert-body")||e("#"+d).addClass("evalert-body"),e("#"+d).append('<div class="evalert-toolbar"></div><div class="evalert-content"></div>'),e("#"+d+" .evalert-toolbar").append('<span class="evalert-toolbar-title"></span><span class="evalert-toolbar-title-evnt-counter-open"> - (</span><span class="evalert-toolbar-title-evnt-counter">0</span><span class="evalert-toolbar-title-evnt-counter-close">)</span><div class="evalert-buutons"><span class="evalert-minimze-maximize evalert-icon-min"></span><span class="evalert-close">X</span></div>'),e("#"+d+" .evalert-toolbar-title").html(c.title);var p=l(e(this)[0]);if("rtl"==p&&e("#"+d).attr("dir","ltr"),0!=c.alertWinWidth&&e("#"+d).css("width",c.alertWinWidth),0!=c.bodyBorderColor&&e("#"+d).css("background",c.bodyBorderColor),0!=c.titleBgColor&&e("#"+d+" .evalert-toolbar").css("background",c.titleBgColor),0!=c.titleTextColor&&e("#"+d+" .evalert-toolbar").css("color",c.titleTextColor),0!=c.titleFontSize&&e("#"+d+" .evalert-toolbar").css("font-size",c.titleFontSize),0!=c.alertWinHeight&&e("#"+d+" .evalert-content").css("height",c.alertWinHeight),0!=c.contentBgColor&&e("#"+d+" .evalert-content").css("background",c.contentBgColor),0!=c.contentFontSize&&e("#"+d+" .evalert-content").css("font-size",c.contentFontSize),0!=c.alertWinPos)switch(c.alertWinPos){case"tl":e("#"+d).css({position:"absolute",top:"0",left:"0"});break;case"tr":e("#"+d).css({position:"absolute",top:"0",right:"0"});break;case"bl":e("#"+d).css({position:"absolute",bottom:"0",left:"0"});break;case"br":e("#"+d).css({position:"absolute",bottom:"0",right:"0"});break;case"ftl":e("#"+d).css({position:"fixed",top:"0",left:"0"});break;case"ftr":e("#"+d).css({position:"fixed",top:"0",right:"0"});break;case"fbl":e("#"+d).css({position:"fixed",bottom:"0",left:"0"});break;case"fbr":e("#"+d).css({position:"fixed",bottom:"0",right:"0"});break;case"draggable":e("#"+d).css({position:"absolute",top:"0",right:"0",cursor:"move"}),e("#"+d).attr("draggable","true"),e("#"+d).on("dragstart",function(t){var r=e(this).position();t.originalEvent.dataTransfer.setData("text",r.left-t.clientX+","+(r.top-t.clientY))}),e(document.body).on("dragover",function(e){return e.preventDefault(),!1}),e(document.body).on("drop",function(t){t.preventDefault();var r=t.originalEvent.dataTransfer.getData("text").split(",");return e("#"+d).css("left",t.clientX+parseInt(r[0],10)+"px"),e("#"+d).css("top",t.clientY+parseInt(r[1],10)+"px"),!1})}e("#"+d+" .evalert-minimze-maximize").click(function(){e(this).hasClass("evalert-icon-max")?e(this).addClass("evalert-icon-min").removeClass("evalert-icon-max"):e(this).addClass("evalert-icon-max").removeClass("evalert-icon-min"),e("#"+d+" .evalert-content").slideToggle()}),e("#"+d+" .evalert-close").click(function(){e("#"+d).hide()})}}(jQuery);